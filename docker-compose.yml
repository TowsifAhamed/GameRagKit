version: '3.8'

services:
  # PostgreSQL with pgvector for vector storage
  postgres:
    image: postgres:16
    container_name: gamerag-postgres
    environment:
      POSTGRES_DB: gamerag
      POSTGRES_USER: gamerag
      POSTGRES_PASSWORD: gamerag123
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U gamerag"]
      interval: 5s
      timeout: 5s
      retries: 5

  # Alternative: Qdrant vector database
  qdrant:
    image: qdrant/qdrant:latest
    container_name: gamerag-qdrant
    ports:
      - "6333:6333"
      - "6334:6334"  # gRPC port
    volumes:
      - qdrant_data:/qdrant/storage
    profiles:
      - qdrant  # Only start if explicitly requested: docker-compose --profile qdrant up

  # Optional: Local Ollama for fully offline operation
  ollama:
    image: ollama/ollama:latest
    container_name: gamerag-ollama
    ports:
      - "11434:11434"
    volumes:
      - ollama_data:/root/.ollama
    profiles:
      - local  # Only start if explicitly requested: docker-compose --profile local up
    # After starting, run: docker exec -it gamerag-ollama ollama pull llama3

volumes:
  postgres_data:
  qdrant_data:
  ollama_data:

# Usage Examples:
#
# Start PostgreSQL only (recommended for cloud provider usage):
#   docker-compose up -d
#
# Start Qdrant instead of PostgreSQL:
#   docker-compose --profile qdrant up -d qdrant
#
# Start everything including local Ollama:
#   docker-compose --profile local up -d
#
# Stop all services:
#   docker-compose down
#
# Remove all data (WARNING: deletes all vectors and config):
#   docker-compose down -v
